# File to sort the dataset generated by create_COVIDx.ipynb such that it can be used easily with Keras imagedatagenerator

# import the os module
import os

# detect the current working directory and print it
path = os.getcwd()
print ("The current working directory is %s" % path)

def sort_dataset(files_csv, folder, dataset_type):
	labels=[]
	for file in files_csv:
		# Extracting class labels
		label = file.split()[-2]
		if label not in labels:
			labels.append(label)
			path_folder = os.path.join(path, folder, dataset_type, label)
			try:
				os.mkdir(path_folder)
			except OSError:
				print ("Creation of the directory %s failed" % path_folder)
			else:
				print ("Successfully created the directory %s " % path_folder)
		os.rename(os.path.join(path, folder, dataset_type, file.split()[1]), os.path.join(path, folder, dataset_type, label, file.split()[1]))

with open("train_split.txt") as f:
    train_files = f.readlines()
with open("test_split.txt") as f:
    test_files = f.readlines()

sort_dataset(train_files, "data", "train")
print("Training dataset sorted")
sort_dataset(test_files, "data","test")
print("Testing dataset sorted")